name: "CodeQL Analysis (SAD Lab)"

on:
  push:
    branches: ["main", "master"]
  pull_request:
    # Run on PRs to any branch
    types: [opened, synchronize, reopened]
  schedule:
    - cron: '0 3 * * 0'     # weekly run (UTC) â€” change as needed
  workflow_dispatch: {}     # manual trigger

jobs:
  codeql-analyze:
    name: CodeQL Analyze (SAD Lab)
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'javascript', 'python', 'java' ]  # add/remove languages your repo uses

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up JDK (for Java analysis/build)
        if: matrix.language == 'java'
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: ${{ matrix.language }}
          # use the built-in security-and-quality suite; you can add others or custom packs here
          queries: security-and-quality

      - name: Autobuild (recommended)
        uses: github/codeql-action/autobuild@v2
        # If autobuild doesn't work for your project, replace this step with your build commands,
        # e.g. npm ci && npm run build, mvn -B package --quiet, pip install -r requirements.txt, etc.

      - name: Run CodeQL analysis
        uses: github/codeql-action/analyze@v2
        with:
          # category helps classify results in the UI; optional
          category: 'SAD-lab-scan'
          # Produces a SARIF in the workflow artifacts & surfaces results to the Security tab
          # output: results.sarif   # (optional) uncomment to persist SARIF as artifact

      - name: Upload SARIF (optional)
        if: always()
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: results.sarif
